# saved_analyses - 분석 결과 자동 저장

## 개요
이 폴더는 BatchPro 시스템에서 생성된 모든 분석 결과를 자동으로 저장하는 곳입니다. 동일한 실험/질문에 대한 재분석 시 기존 결과를 자동으로 로드하여 분석 시간을 대폭 단축합니다.

## 저장 시스템 특징

### 🚀 **자동 저장 (Auto-Save)**
- **실시간 저장**: 분석 실행 시 모든 결과가 자동으로 저장
- **고유 ID 생성**: 실험명과 질문 인덱스를 기반으로 고유 식별자 생성
- **덮어쓰기 지원**: 기존 분석이 있으면 자동으로 업데이트

### ⚡ **자동 로드 (Auto-Load)**
- **즉시 결과 확인**: 동일한 실험/질문 조합에 대해 기존 분석 자동 로드
- **시간 절약**: 기존: 30초~2분 → 개선: 즉시 결과 확인
- **일관성 보장**: 동일한 데이터에 대한 일관된 분석 결과

### 🔄 **스마트 캐싱**
- **해시 기반 중복 감지**: 동일한 데이터 재저장 방지
- **메타데이터 분리**: 빠른 검색을 위한 별도 JSON 파일
- **압축 저장**: pickle을 통한 효율적인 직렬화

## 파일 구조

### **저장 파일 형식**
```
{실험명}_Q{질문인덱스}_{해시값}.pkl
```

### **예시 파일명**
- `experiment_20250817_000055_Q2_all_4bdb0e6b.pkl`
- `experiment_20250817_000229_Q2_structured_56429df0.pkl`
- `experiment_20250817_000401_Q2_structured_ba0c52f9.pkl`

### **메타데이터 파일**
- `{실험명}_Q{질문인덱스}_{해시값}_metadata.json`
- 분석 정보, 생성 시간, 데이터 해시 등 포함

## 저장되는 데이터

### **1. 기본 시각화 결과**
- **레이더 차트**: TCI 성향별 다차원 프로파일
- **히트맵**: 페르소나 간 응답 유사도
- **정렬 차트**: 응답 특성별 정렬 결과

### **2. 구조화된 분석 결과**
- **페르소나 응답**: 각 페르소나별 응답 텍스트
- **자동 태깅**: 6가지 축별 자동 분류 결과
  - 감정 방향 (긍정/부정/중립)
  - 감정 강도 (약함/보통/강함)
  - 행동 성향 (수동적/능동적/회피적)
  - 관계 지향성 (자기중심/타인지향/균형)
  - 지원 요청 여부 (암시적/명시적/없음)
  - 표현 스타일 (위로형/정보형/명령형)

### **3. 유사도 분석 결과**
- **유사도 행렬**: 모든 응답 간 코사인 유사도
- **클러스터링 결과**: K-means, DBSCAN 라벨
- **차원 축소**: t-SNE, PCA 좌표

## 사용 방법

### **1. 자동 저장/로드**
```python
# 분석 시작 시 자동으로 기존 결과 확인
# 기존 결과가 있으면 즉시 로드
# 새로운 분석 시 자동 저장
```

### **2. 수동 관리**
```python
# 저장된 분석 목록 조회
GET /visualization/saved-analyses

# 특정 분석 결과 로드
GET /visualization/saved-analyses/{analysis_id}

# 분석 결과 삭제
DELETE /visualization/saved-analyses/{analysis_id}
```

### **3. 메타데이터 조회**
```python
# 분석 정보 및 통계
GET /visualization/analysis-info/{analysis_id}
```

## 성능 최적화

### **Batch 처리 지원**
- **LLM 태깅 성능**: 개별 처리 대비 **3-5배 빠른 속도**
- **배치 크기**: 기본 10개 응답을 한 번에 처리
- **API 호출 최적화**: OpenAI API 호출 횟수 대폭 감소

### **저장 최적화**
- **해시 기반 중복 감지**: 동일 데이터 재저장 방지
- **압축 저장**: pickle을 통한 효율적인 직렬화
- **메타데이터 분리**: 빠른 검색을 위한 별도 JSON 파일

## 데이터 구조

### **저장 데이터 예시**
```json
{
  "analysis_id": "experiment_20250817_Q0",
  "experiment_name": "experiment_20250817_000055",
  "question_index": 0,
  "data_hash": "4bdb0e6b",
  "created_at": "2025-08-17T00:00:55",
  "analysis_data": {
    "radar_chart": {...},
    "heatmap": {...},
    "sorting_chart": {...},
    "structured_analysis": {...}
  }
}
```

### **메타데이터 예시**
```json
{
  "analysis_id": "experiment_20250817_Q0",
  "total_personas": 25,
  "total_responses": 25,
  "analysis_type": "structured",
  "processing_time": "45.2초",
  "model_used": "gpt-4-turbo-preview"
}
```

## 모니터링 및 관리

### **저장 상태 모니터링**
- **저장 성공률**: 자동 저장 성공/실패 통계
- **저장 용량**: 디스크 사용량 및 공간 효율성
- **접근 빈도**: 자주 사용되는 분석 결과 추적

### **정리 및 최적화**
- **오래된 분석**: 일정 기간 후 자동 정리
- **중복 제거**: 동일한 데이터 해시 기반 중복 감지
- **공간 최적화**: 불필요한 파일 자동 제거

## 문제 해결

### **저장 실패**
- **권한 문제**: `saved_analyses` 폴더 권한 확인
- **공간 부족**: 디스크 공간 확인 및 정리
- **파일명 오류**: 사용할 수 없는 문자 제거

### **로드 실패**
- **파일 손상**: pickle 파일 무결성 확인
- **메타데이터 불일치**: JSON 파일과 pickle 파일 동기화
- **버전 호환성**: Python 버전 및 라이브러리 호환성 확인

### **성능 문제**
- **저장 지연**: 디스크 I/O 성능 확인
- **메모리 부족**: 대용량 데이터 처리 시 청크 단위 저장
- **네트워크 지연**: 원격 저장소 사용 시 연결 상태 확인

## 향후 개선 계획

### **단기 개선**
- **압축 알고리즘**: 더 효율적인 압축 방식 적용
- **인덱싱**: 빠른 검색을 위한 인덱스 시스템 구축
- **백업**: 자동 백업 및 복구 시스템

### **장기 개선**
- **분산 저장**: 여러 서버에 분산 저장
- **버전 관리**: 분석 결과의 버전 관리 시스템
- **AI 기반 최적화**: 사용 패턴 기반 저장 전략 최적화

## 라이선스
이 프로젝트는 MIT 라이선스 하에 배포됩니다.
