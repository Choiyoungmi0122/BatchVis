<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>BatchVis + ì‹¤í—˜ ì‹œì‘</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background-color: #F0F7FB;
      font-family: 'Roboto', sans-serif;
    }

    .container {
      display: flex;
      flex-direction: row;
      width: 96%;
      padding: 32px;
    }

    .left-panel {
      display: flex;
      flex-direction: column;
      width: 30%;
      margin-right: 24px;
    }

    .header {
      margin-bottom: 16px;
    }

    .title {
      font-family: 'IBM Plex Mono', monospace;
      font-size: 36px;
      font-weight: 700;
      color: #3D2D4C;
      margin: 0;
    }

    .underline {
      border: none;
      height: 1px;
      background-color: #B7BCC9;
      margin-top: 6px;
    }

    .sidebar {
      background-color: #ffffff;
      border-radius: 4px;
      box-shadow: 0 0 11px rgba(128, 139, 157, 0.15);
      padding: 24px;
      font-size: 16px;
      line-height: 1.6;
      height: 794px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .display-area {
      flex: 1;
      overflow-y: auto;
      margin-bottom: 16px;
      white-space: pre-line;
    }

    .input-box {
      display: flex;
      align-items: center;
      gap: 12px;
      justify-content: flex-end;
    }

    .input-box textarea {
      flex: 1;
      height: 48px;
      padding: 10px;
      font-size: 16px;
      resize: none;
      border-radius: 6px;
      border: 1px solid #ccc;
    }

    .input-box button {
      background-color: #8E12D5;
      color: white;
      border: none;
      padding: 8px 15px;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
    }

    .main-panel {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 20px;
      padding-top: 85px;

    }

    .question-box label {
      font-weight: bold;
    }

    .question-box select {
      width: 100%;
      height: 40px;
      font-size: 16px;
      margin-top: 8px;
    }

    .response-box {
      background-color: #fff;
      border-radius: 4px;
      padding: 16px;
      box-shadow: 0 0 11px rgba(128, 139, 157, 0.15);
      position: relative;
    }

    .response-box button {
      position: absolute;
      bottom: 12px;
      right: 12px;
      background-color: #C5C0CA;
      border: none;
      padding: 6px 14px;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
    }

    /* ì‹¤í—˜ ì‹œì‘ ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
    .experiment-section {
      background-color: #ffffff;
      margin-top: 10px;
      padding: 2px 16px;
      border-radius: 6px;
      box-shadow: 0 0 11px rgba(128, 139, 157, 0.15);
      margin-bottom: 10px;
    }

    .experiment-section h2 {
      font-size: 20px;
      margin-bottom: 12px;
      color: #3D2D4C;
    }

    .experiment-section label {
      display: block;
      margin-top: 8px;
      font-weight: bold;
    }

    .experiment-section input {
      width: 85%;
      height: 32px;
      font-size: 16px;
      margin-top: 4px;
      padding: 6px;
      border: 1px solid #ccc;
      border-radius: 4px;
      background-color: #f5f5f5;
      color: #000;
    }

    .experiment-section button {
      margin-top: 12px;
      background-color: #8E12D5;
      color: white;
      border: none;
      padding: 8px 14px;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
    }

    #result {
      margin-top: 20px;
    }
    
    .instruction-box {
        border: none;
        padding: 15px;
        margin: 10px 0;
        font-family: monospace;
        font-size: 14px;
        white-space: pre-wrap;
        line-height: 1.6;
    }
    .pagination {
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 20px 0;
        gap: 10px;
    }
    .pagination button {
        padding: 8px 12px;
        border: 1px solid #ccc;
        background: white;
        cursor: pointer;
    }
    .pagination button:disabled {
        background: #f0f0f0;
        cursor: not-allowed;
    }
    .pagination .current {
        background: #007bff;
        color: white;
        border-color: #007bff;
    }
    .loading {
        color: #666;
        font-style: italic;
    }
  </style>
  <script>
    let experimentNum = null;
    let experimentActive = false;
    let currentInstructions = [];
    let currentAnswers = [];  // ë‹µë³€ ë°ì´í„° ì¶”ê°€
    let currentPage = 0;
    let instructionsPerPage = 1;
    let currentInput = '';  // í˜„ì¬ ì…ë ¥ê°’ ì €ì¥

    async function startExperiment() {
        try {
            const res = await fetch('/start_experiment', { method: 'POST' });
            const data = await res.json();
            experimentNum = data.experiment_num;
            experimentActive = true;
            
            // ì‹¤í—˜ ì‹œì‘ ìƒíƒœ ì„¤ì •
            isExperimentRunning = true;
            stopRequested = false;
            currentExperimentData = {
                experiment_num: data.experiment_num,
                timestamp: new Date().toISOString(),
                user_input: '',
                prompts: []
            };
            
            // experiment_num ì…ë ¥ í•„ë“œì— ì‹¤í—˜ ë²ˆí˜¸ í‘œì‹œ
            document.getElementById('experiment_num').value = experimentNum;
            document.getElementById('experiment_num').readOnly = true; // ìˆ˜ì • ë¶ˆê°€ëŠ¥í•˜ê²Œ ì„¤ì •
            
            // ë²„íŠ¼ ìƒíƒœ ë³€ê²½
            document.getElementById('start-btn').style.display = 'none';
            document.getElementById('stop-btn').style.display = 'inline-block';
            document.getElementById('end-btn').style.display = 'inline-block';
            
            // ë””ë²„ê¹…ì„ ìœ„í•œ ì½˜ì†” ë¡œê·¸
            console.log('ë©ˆì¶¤ ë²„íŠ¼ í‘œì‹œ:', document.getElementById('stop-btn').style.display);
            console.log('ì‹¤í—˜ ì™„ë£Œ ë²„íŠ¼ í‘œì‹œ:', document.getElementById('end-btn').style.display);
            
            const display = document.getElementById('displayArea');
            display.innerHTML = `
                <div style="background-color: #e7f3ff; padding: 15px; border-radius: 8px; border-left: 4px solid #17a2b8;">
                    <p style="margin: 0; color: #0056b3;"><strong>ì‹¤í—˜ ì§„í–‰ ì¤‘:</strong> ì‹¤í—˜ ë²ˆí˜¸ ${data.experiment_num}</p>
                    <p style="margin: 5px 0 0 0; color: #0056b3;">í”„ë¡¬í”„íŠ¸ë¥¼ ì…ë ¥í•˜ê³  ì „ì†¡í•˜ê±°ë‚˜, ë©ˆì¶¤ ë²„íŠ¼ì„ ëˆŒëŸ¬ í˜„ì¬ê¹Œì§€ì˜ ê²°ê³¼ë¥¼ ì €ì¥í•˜ì„¸ìš”.</p>
                </div>
            `;
            
            document.getElementById('result').innerText = 'ì‹¤í—˜ì„ ì‹œì‘í–ˆìŠµë‹ˆë‹¤. ì´ì œ í™˜ì ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.';
        } catch (error) {
            document.getElementById('result').innerText = `ì˜¤ë¥˜ ë°œìƒ: ${error.message}`;
        }
    }

    async function stopExperiment() {
      if (!isExperimentRunning) {
        alert('ì‹¤í—˜ì„ ë¨¼ì € ì‹œì‘í•˜ì„¸ìš”.');
        return;
      }
      
      stopRequested = true;
      isExperimentRunning = false;
      
      // í˜„ì¬ê¹Œì§€ì˜ ì‹¤í—˜ ë°ì´í„° ì €ì¥
      if (currentExperimentData && currentExperimentData.user_input) {
        try {
          const response = await fetch('/save_experiment', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(currentExperimentData)
          });
          
          if (response.ok) {
            const result = await response.json();
            document.getElementById('result').innerHTML = `
              <div style="color: orange;">
                <strong>ì‹¤í—˜ ì¤‘ë‹¨ë¨:</strong> í˜„ì¬ê¹Œì§€ì˜ ê²°ê³¼ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.<br>
                íŒŒì¼ëª…: ${result.filename}
              </div>
            `;
          } else {
            document.getElementById('result').innerHTML = '<div style="color: red;">ì €ì¥ ì‹¤íŒ¨</div>';
          }
        } catch (error) {
          console.error('ì €ì¥ ì˜¤ë¥˜:', error);
          document.getElementById('result').innerHTML = '<div style="color: red;">ì €ì¥ ì¤‘ ì˜¤ë¥˜ ë°œìƒ</div>';
        }
      } else {
        document.getElementById('result').innerHTML = '<div style="color: orange;">ì‹¤í—˜ ì¤‘ë‹¨ë¨ (ì €ì¥í•  ë°ì´í„° ì—†ìŒ)</div>';
      }
      
      // ë²„íŠ¼ ìƒíƒœ ë³µì›
      document.getElementById('start-btn').style.display = 'inline-block';
      document.getElementById('stop-btn').style.display = 'none';
      document.getElementById('end-btn').style.display = 'none';
      
      // displayArea ì—…ë°ì´íŠ¸
      document.getElementById('displayArea').innerHTML = `
        <div style="background-color: #fff3cd; padding: 15px; border-radius: 8px; border-left: 4px solid #ffc107;">
          <p style="margin: 0; color: #856404;"><strong>ì‹¤í—˜ ì¤‘ë‹¨ë¨:</strong> ìƒˆë¡œìš´ ì‹¤í—˜ì„ ì‹œì‘í•˜ë ¤ë©´ "ì‹¤í—˜ ì‹œì‘" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</p>
        </div>
      `;
      
      // ì‹¤í—˜ ìƒíƒœ ì´ˆê¸°í™”
      experimentActive = false;
      currentExperimentData = null;
    }

    function endExperiment() {
      if (!experimentActive) {
        alert('ì‹¤í—˜ì„ ë¨¼ì € ì‹œì‘í•˜ì„¸ìš”.');
        return;
      }
      experimentActive = false;
      document.getElementById('result').innerText = 'ì‹¤í—˜ ì™„ë£Œ';
      
      // ë²„íŠ¼ ìƒíƒœ ë³µì›
      document.getElementById('start-btn').style.display = 'inline-block';
      document.getElementById('stop-btn').style.display = 'none';
      document.getElementById('end-btn').style.display = 'none';
    }

    async function checkBatchStatus() {
        const batchId = document.getElementById('batch_id').value.trim();
        if (!batchId) {
            alert('Batch IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            return;
        }
        
        const resultDiv = document.getElementById('batch-status-result');
        resultDiv.innerHTML = '<div style="color: #17a2b8;">Batch ìƒíƒœ í™•ì¸ ì¤‘...</div>';
        
        try {
            const response = await fetch(`/check_batch_status/${batchId}`);
            const data = await response.json();
            
            if (response.ok) {
                if (data.status === 'completed') {
                    resultDiv.innerHTML = `
                        <div style="color: #28a745; background-color: #d4edda; padding: 10px; border-radius: 4px; border: 1px solid #c3e6cb;">
                            <strong>âœ… ì‘ë‹µëª¨ë‘ ë°›ìŒ!</strong><br>
                            ì´ ì‘ë‹µ ìˆ˜: ${data.total_responses}ê°œ<br>
                            ì €ì¥ íŒŒì¼: ${data.saved_file}<br>
                            ì™„ë£Œ ì‹œê°„: ${data.batch_info.completed_at || 'N/A'}
                        </div>
                    `;
                    console.log("ì‘ë‹µëª¨ë‘ ë°›ìŒ");
                } else if (data.status === 'failed') {
                    resultDiv.innerHTML = `
                        <div style="color: #dc3545; background-color: #f8d7da; padding: 10px; border-radius: 4px; border: 1px solid #f5c6cb;">
                            <strong>âŒ Batch ì²˜ë¦¬ ì‹¤íŒ¨</strong><br>
                            ì˜¤ë¥˜: ${data.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}
                        </div>
                    `;
                } else if (data.status === 'expired') {
                    resultDiv.innerHTML = `
                        <div style="color: #ffc107; background-color: #fff3cd; padding: 10px; border-radius: 4px; border: 1px solid #ffeaa7;">
                            <strong>âš ï¸ Batch ì²˜ë¦¬ ë§Œë£Œ</strong><br>
                            Batch ID: ${data.batch_info.id}
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div style="color: #17a2b8; background-color: #d1ecf1; padding: 10px; border-radius: 4px; border: 1px solid #bee5eb;">
                            <strong>ğŸ”„ Batch ì²˜ë¦¬ ì¤‘...</strong><br>
                            ìƒíƒœ: ${data.status}<br>
                            ìƒì„± ì‹œê°„: ${data.batch_info.created_at || 'N/A'}
                        </div>
                    `;
                }
            } else {
                resultDiv.innerHTML = `
                    <div style="color: #dc3545; background-color: #f8d7da; padding: 10px; border-radius: 4px; border: 1px solid #f5c6cb;">
                        <strong>âŒ ìƒíƒœ í™•ì¸ ì‹¤íŒ¨</strong><br>
                        ì˜¤ë¥˜: ${data.message || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'}
                    </div>
                `;
            }
        } catch (error) {
            resultDiv.innerHTML = `
                <div style="color: #dc3545; background-color: #f8d7da; padding: 10px; border-radius: 4px; border: 1px solid #f5c6cb;">
                    <strong>âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜</strong><br>
                    ì˜¤ë¥˜: ${error.message}
                </div>
            `;
        }
    }

    async function submitText() {
        const input = document.getElementById('inputText').value;
        const display = document.getElementById('displayArea');
        const loading = document.getElementById('loading');

        if (!input || !experimentActive) {
            alert('ì‹¤í—˜ì„ ë¨¼ì € ì‹œì‘í•˜ê³  í™˜ì ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”.');
            return;
        }

        // ì…ë ¥ê°’ ì €ì¥
        currentInput = input;
        
        // ì‹¤í—˜ ë°ì´í„° ì—…ë°ì´íŠ¸
        if (currentExperimentData) {
          currentExperimentData.user_input = input;
        }
        
        display.innerHTML = `<div style='margin-bottom:10px;'><strong>ì…ë ¥:</strong> ${input}</div>`;
        loading.style.display = 'block';
        loading.innerText = 'ê°€ìƒí™˜ì ì¡°í•© ìƒì„± ì¤‘...';

        try {
            // 1ë‹¨ê³„: Instruction ìƒì„±
            const instructionRes = await fetch('/generate_instructions', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ user_input: input })
            });
            let instructionData;
            if (instructionRes.ok && instructionRes.headers.get('content-type')?.includes('application/json')) {
                instructionData = await instructionRes.json();
            } else {
                const text = await instructionRes.text();
                throw new Error('ì„œë²„ ì˜¤ë¥˜: ' + text);
            }
            currentInstructions = instructionData.instructions || [];
            currentPage = 0;
            instructionsPerPage = 1;
            if (currentInstructions.length > 0) {
                displayInstruction(currentPage);
                showPagination();
                loading.innerText = `ê°€ìƒí™˜ì ì¡°í•© ìƒì„± ì™„ë£Œ! (${currentInstructions.length}ê°œ ì¡°í•©)`;
                // 2ë‹¨ê³„: Batch ì²˜ë¦¬
                loading.innerText = 'Batch API ì‘ì—… ì œì¶œ ì¤‘...';
                const batchRes = await fetch('/process_qa_batch', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        experiment_num: experimentNum,
                        user_input: input
                    })
                });
                let batchData = await batchRes.json();
                if (batchRes.ok) {
                    display.innerHTML = `
                        <div style='margin-bottom:10px;'><strong>ì…ë ¥:</strong> ${input}</div>
                        <div style='margin-bottom:10px;'><strong>Batch ID:</strong> ${batchData.batch_id}</div>
                        <div style='margin-bottom:10px;'><strong>ìš”ì²­ ìˆ˜:</strong> ${batchData.request_count}ê°œ</div>
                        <div style='margin-bottom:10px;'><strong>ì¡°í•© ìˆ˜:</strong> ${batchData.combination_count}ê°œ</div>
                        <div style='margin-bottom:10px;'><strong>ì§ˆë¬¸ ìˆ˜:</strong> ${batchData.questions_count}ê°œ</div>
                        <div style='margin-bottom:10px;'><strong>ì˜ˆìƒ ì™„ë£Œ:</strong> 2-4ì‹œê°„ í›„</div>
                        <div style='margin-bottom:10px;'><strong>ëŒ€ì‹œë³´ë“œ:</strong> <a href="${batchData.openai_dashboard_url}" target="_blank">OpenAI Batch ëŒ€ì‹œë³´ë“œ</a></div>
                    `;
                    
                    // Batch ìƒíƒœ í™•ì¸ ì„¹ì…˜ í‘œì‹œ ë° Batch ID ì„¤ì •
                    document.getElementById('batch-status-section').style.display = 'block';
                    document.getElementById('batch_id').value = batchData.batch_id;
                    
                    // loading.innerText = 'Batch ì‘ì—…ì´ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤. 2-4ì‹œê°„ í›„ ê²°ê³¼ íŒŒì¼ì„ í™•ì¸í•˜ì„¸ìš”.';
                    // document.getElementById('result').innerText = `Batch ì‘ì—… ì œì¶œ ì™„ë£Œ! (${batchData.request_count}ê°œ ìš”ì²­)`;
                    document.getElementById('result');
                } else {
                    throw new Error(batchData.error || 'Batch ì‘ì—… ì œì¶œ ì‹¤íŒ¨');
                }
                setTimeout(() => {
                    loading.style.display = 'none';
                }, 3000);
            } else {
                loading.innerText = 'ê°€ìƒí™˜ì ì¡°í•© ìƒì„± ì‹¤íŒ¨';
            }
        } catch (error) {
            document.getElementById('result').innerText = `ì˜¤ë¥˜ ë°œìƒ: ${error.message}`;
            loading.innerText = 'ì˜¤ë¥˜ ë°œìƒ';
        }
        document.getElementById('inputText').value = '';
    }

    function displayInstruction(pageIndex) {
        const display = document.getElementById('displayArea');
        
        if (currentInstructions.length === 0) return;
        
        const instruction = currentInstructions[pageIndex];
        // detail ì •ë³´ ë¬¸ìì—´ ìƒì„±
        let detailStr = '';
        if (instruction.type === 'personality') {
            detailStr = Object.entries(instruction.detail || {}).map(([k,v]) => `${k}: ${v}`).join(', ');
        } else if (instruction.type === 'character') {
            detailStr = Object.entries(instruction.detail || {}).map(([k,v]) => `${k}: ${v}`).join(', ');
        } else if (instruction.type === 'personality+character') {
            const t = instruction.detail?.temperament || {};
            const c = instruction.detail?.character || {};
            detailStr = `[Temperament] ` + Object.entries(t).map(([k,v]) => `${k}: ${v}`).join(', ') + ' | [Character] ' + Object.entries(c).map(([k,v]) => `${k}: ${v}`).join(', ');
        }
        
        display.innerHTML = `
            <div style='margin-bottom:10px;'><strong>ì…ë ¥:</strong> ${currentInput}</div>
            <div style='margin-bottom:10px;'><strong>ì¡°í•©:</strong> ${detailStr}</div>
            <div class="instruction-box">
                <strong>[${(instruction.type || 'UNKNOWN').toUpperCase()}]</strong>
                ${instruction.prompt || instruction.virtual_patient_prompt || 'í”„ë¡¬í”„íŠ¸ ì—†ìŒ'}
            </div>
        `;
        
        updatePagination();
    }

    async function displayResponsesByQuestion(selectedQuestionIdx) {
        console.log('ğŸš€ displayResponsesByQuestion í˜¸ì¶œë¨:', selectedQuestionIdx);
        console.log('ğŸ” currentInstructions ê¸¸ì´:', currentInstructions.length);
        
        const mainPanel = document.querySelector('.main-panel');
        console.log('ğŸ” mainPanel ì°¾ìŒ:', mainPanel);
        
        // ê¸°ì¡´ response-boxë“¤ ì œê±°
        const existingResponses = mainPanel.querySelectorAll('.response-box');
        existingResponses.forEach(box => box.remove());
        console.log('ğŸ” ê¸°ì¡´ response-box ì œê±°ë¨');
        
        // ì§ˆë¬¸ í…ìŠ¤íŠ¸ ê°€ì ¸ì˜¤ê¸°
        const select = document.getElementById('question');
        const questionText = select.options[selectedQuestionIdx + 1]?.textContent;
        console.log('ğŸ” ì„ íƒëœ ì§ˆë¬¸ í…ìŠ¤íŠ¸:', questionText);
        
        if (!questionText) {
            console.log('âŒ ì§ˆë¬¸ í…ìŠ¤íŠ¸ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
            return;
        }
        
        // í˜„ì¬ ì§ˆë¬¸ì— ëŒ€í•œ ë‹µë³€ì´ ì´ë¯¸ ìˆëŠ”ì§€ í™•ì¸
        let hasExistingAnswers = false;
        if (currentInstructions.length > 0) {
            hasExistingAnswers = currentInstructions.some(inst => 
                inst.qa && inst.qa[selectedQuestionIdx] && inst.qa[selectedQuestionIdx].answer
            );
        }
        
        // ë‹µë³€ ëŒ€ê¸°ì¤‘ UI ë¯¸ë¦¬ í‘œì‹œ
        currentInstructions.forEach((inst, idx) => {
            let detailStr = '';
            if (inst.type === 'personality') {
                detailStr = Object.entries(inst.detail || {}).map(([k,v]) => `${k}: ${v}`).join(', ');
            } else if (inst.type === 'character') {
                detailStr = Object.entries(inst.detail || {}).map(([k,v]) => `${k}: ${v}`).join(', ');
            } else if (inst.type === 'personality+character') {
                const t = inst.detail?.temperament || {};
                const c = inst.detail?.character || {};
                detailStr = `[Temperament] ` + Object.entries(t).map(([k,v]) => `${k}: ${v}`).join(', ') + ' | [Character] ' + Object.entries(c).map(([k,v]) => `${k}: ${v}`).join(', ');
            }
            const responseBox = document.createElement('div');
            responseBox.className = 'response-box';
            
            // ì´ë¯¸ ë‹µë³€ì´ ìˆìœ¼ë©´ ë°”ë¡œ í‘œì‹œ
            if (inst.qa && inst.qa[selectedQuestionIdx] && inst.qa[selectedQuestionIdx].answer) {
                const qa = inst.qa[selectedQuestionIdx];
                responseBox.innerHTML = `
                    <div style="font-size:13px; color:#888; margin-bottom:6px;">${inst.type?.toUpperCase() || 'UNKNOWN'} | ${detailStr}</div>
                    <p>${qa.answer || 'ë‹µë³€ ì—†ìŒ'}</p>
                    <button>ì„ íƒ</button>
                `;
            } else {
                responseBox.innerHTML = `
                    <div style="font-size:13px; color:#888; margin-bottom:6px;">${inst.type?.toUpperCase() || 'UNKNOWN'} | ${detailStr}</div>
                    <p style="color:#aaa;">ë‹µë³€ ëŒ€ê¸°ì¤‘...</p>
                `;
            }
            mainPanel.appendChild(responseBox);
        });
        
        // ì´ë¯¸ ë‹µë³€ì´ ìˆìœ¼ë©´ API í˜¸ì¶œí•˜ì§€ ì•ŠìŒ
        if (hasExistingAnswers) {
            return;
        }
        
        // ë°±ì—”ë“œì— batch ìš”ì²­
        console.log('ğŸ” API í˜¸ì¶œ ì „ ê°’ í™•ì¸:');
        console.log('  - experiment_num:', experimentNum);
        console.log('  - currentInput:', currentInput);
        console.log('  - question_text:', questionText);
        console.log('  - currentInstructions ê¸¸ì´:', currentInstructions.length);
        
        let data;
        try {
            const res = await fetch('/process_qa_one_question', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    experiment_num: experimentNum,
                    instructions: currentInstructions,
                    user_input: currentInput,
                    question_text: questionText
                })
            });
            if (res.ok && res.headers.get('content-type')?.includes('application/json')) {
                data = await res.json();
            } else {
                const text = await res.text();
                throw new Error('ì„œë²„ ì˜¤ë¥˜: ' + text);
            }
        } catch (err) {
            document.getElementById('result').innerText = `ì˜¤ë¥˜ ë°œìƒ: ${err.message}`;
            return;
        }
        // ë‹µë³€ ì˜¤ë©´ UI ê°±ì‹ í•˜ê³  currentInstructionsì— ì €ì¥
        const boxes = mainPanel.querySelectorAll('.response-box');
        data.answers.forEach((ans, idx) => {
            if (!boxes[idx]) return;
            let detailStr = '';
            if (ans.type === 'personality') {
                detailStr = Object.entries(ans.detail || {}).map(([k,v]) => `${k}: ${v}`).join(', ');
            } else if (ans.type === 'character') {
                detailStr = Object.entries(ans.detail || {}).map(([k,v]) => `${k}: ${v}`).join(', ');
            } else if (ans.type === 'personality+character') {
                const t = ans.detail?.temperament || {};
                const c = ans.detail?.character || {};
                detailStr = `[Temperament] ` + Object.entries(t).map(([k,v]) => `${k}: ${v}`).join(', ') + ' | [Character] ' + Object.entries(c).map(([k,v]) => `${k}: ${v}`).join(', ');
            }
            boxes[idx].innerHTML = `
                <div style="font-size:13px; color:#888; margin-bottom:6px;">${ans.type?.toUpperCase() || 'UNKNOWN'} | ${detailStr}</div>
                <p>${ans.answer || 'ë‹µë³€ ì—†ìŒ'}</p>
                <button>ì„ íƒ</button>
            `;
            
            // currentInstructionsì— ë‹µë³€ ì €ì¥
            if (currentInstructions[idx]) {
                if (!currentInstructions[idx].qa) {
                    currentInstructions[idx].qa = [];
                }
                currentInstructions[idx].qa[selectedQuestionIdx] = ans;
            }
        });
    }

    function showPagination() {
        const pagination = document.getElementById('pagination');
        pagination.style.display = 'flex';
        updatePagination();
    }

    function updatePagination() {
        const pageInfo = document.getElementById('pageInfo');
        const totalPages = currentInstructions.length;
        pageInfo.innerText = `${currentPage + 1} / ${totalPages}`;
        
        // ë²„íŠ¼ í™œì„±í™”/ë¹„í™œì„±í™”
        const prevBtn = pagination.querySelector('button:first-child');
        const nextBtn = pagination.querySelector('button:last-child');
        
        prevBtn.disabled = currentPage === 0;
        nextBtn.disabled = currentPage === totalPages - 1;
    }

    function prevPage() {
        if (currentPage > 0) {
            currentPage--;
            displayInstruction(currentPage);
            // í˜„ì¬ ì„ íƒëœ ì§ˆë¬¸ ì¸ë±ìŠ¤ì— ë§ì¶° ë‹µë³€ í‘œì‹œ
            const select = document.getElementById('question');
            const idx = select.selectedIndex - 1;
            if (idx >= 0) {
                displayResponsesByQuestion(idx);
            }
        }
    }

    function nextPage() {
        if (currentPage < currentInstructions.length - 1) {
            currentPage++;
            displayInstruction(currentPage);
            // í˜„ì¬ ì„ íƒëœ ì§ˆë¬¸ ì¸ë±ìŠ¤ì— ë§ì¶° ë‹µë³€ í‘œì‹œ
            const select = document.getElementById('question');
            const idx = select.selectedIndex - 1;
            if (idx >= 0) {
                displayResponsesByQuestion(idx);
            }
        }
    }

    async function populateQuestions() {
      const res = await fetch('/static/questions.json');
      if (res.ok) {
        const questions = await res.json();
        const select = document.getElementById('question');
        select.innerHTML = '<option>ë¬¸í•­ì„ ì„ íƒí•˜ì„¸ìš”</option>';
        questions.forEach((q, idx) => {
          const opt = document.createElement('option');
          opt.value = idx + 1;
          opt.textContent = q.text;
          select.appendChild(opt);
        });
        
        // displayAreaì— ê¸°ë³¸ ì •ë³´ì™€ í”„ë¡¬í”„íŠ¸ í‘œì‹œ
        const displayArea = document.getElementById('displayArea');
        displayArea.innerHTML = `
          <div style="margin-bottom: 20px;">
            <h3 style="color: #333; margin-bottom: 15px;">ğŸ“‹ ê¸°ë³¸ ì •ë³´</h3>
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #007bff;">
              <p><strong>ì‚¬ìš© ê°€ëŠ¥í•œ ì§ˆë¬¸:</strong> ${questions.length}ê°œ</p>
              <p><strong>ì§ˆë¬¸ ì˜ˆì‹œ:</strong></p>
              <ul style="margin: 10px 0; padding-left: 20px;">
                ${questions.slice(0, 3).map(q => `<li>${q.text}</li>`).join('')}
                ${questions.length > 3 ? '<li>... ë“±</li>' : ''}
              </ul>
            </div>
          </div>
          
          <div style="margin-bottom: 20px;">
            <h3 style="color: #333; margin-bottom: 15px;">ğŸ’¬ í”„ë¡¬í”„íŠ¸ ì…ë ¥</h3>
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; border-left: 4px solid #28a745;">
              <p><strong>ì‚¬ìš©ë²•:</strong></p>
              <ol style="margin: 10px 0; padding-left: 20px;">
                <li>ì‹¤í—˜ ì‹œì‘ ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ìƒˆ ì‹¤í—˜ì„ ì‹œì‘í•˜ê±°ë‚˜</li>
                <li>ì €ì¥ëœ ì‹¤í—˜ì„ ë¶ˆëŸ¬ì™€ì„œ ê¸°ì¡´ ë°ì´í„°ë¥¼ í™•ì¸í•˜ì„¸ìš”</li>
                <li>ì§ˆë¬¸ì„ ì„ íƒí•˜ë©´ í•´ë‹¹ ì‘ë‹µì„ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤</li>
              </ol>
            </div>
          </div>
          
          <div style="background: #e7f3ff; padding: 15px; border-radius: 8px; border-left: 4px solid #17a2b8;">
            <p style="margin: 0; color: #0056b3;"><strong>ğŸ’¡ íŒ:</strong> ì‹¤í—˜ì„ ë¶ˆëŸ¬ì˜¨ í›„ ì§ˆë¬¸ì„ ì„ íƒí•˜ë©´ ê° í˜ë¥´ì†Œë‚˜ë³„ ì‘ë‹µì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
          </div>
        `;
      }
    }

    async function fetchExperimentList() {
      const select = document.getElementById('loadExperimentSelect');
      select.innerHTML = '<option value="">ì €ì¥ëœ ì‹¤í—˜ì„ ì„ íƒí•˜ì„¸ìš”</option>';
      console.log('ğŸ” ì‹¤í—˜ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° ì‹œì‘');
      
      try {
        console.log('ğŸ” /list_experiments API í˜¸ì¶œ ì¤‘...');
        const res = await fetch('/list_experiments');
        console.log('ğŸ” API ì‘ë‹µ ìƒíƒœ:', res.status, res.statusText);
        
        if (res.ok) {
          const list = await res.json();
          console.log('âœ… ì‹¤í—˜ ëª©ë¡ ë¡œë“œ ì„±ê³µ:', list);
          list.forEach(item => {
            const label = `${item.date} | ${item.name} | ${item.age}`;
            const opt = document.createElement('option');
            opt.value = item.filename;
            opt.textContent = label;
            select.appendChild(opt);
          });
          console.log(`âœ… ${list.length}ê°œ ì‹¤í—˜ ì˜µì…˜ ì¶”ê°€ë¨`);
        } else {
          console.error('âŒ API ì‘ë‹µ ì‹¤íŒ¨:', res.status, res.statusText);
          const errorText = await res.text();
          console.error('âŒ ì—ëŸ¬ ë‚´ìš©:', errorText);
          select.innerHTML = '<option>API ì‘ë‹µ ì‹¤íŒ¨</option>';
        }
      } catch (e) {
        console.error('âŒ fetchExperimentList ì—ëŸ¬:', e);
        select.innerHTML = '<option>ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨</option>';
      }
    }
    async function loadSelectedExperiment() {
      const select = document.getElementById('loadExperimentSelect');
      const filename = select.value;
      if (!filename) return;
      
      console.log('ğŸ” ì‹¤í—˜ ë¶ˆëŸ¬ì˜¤ê¸° ì‹œì‘:', filename);
      
      try {
        // ì§ì ‘ íŒŒì¼ ì½ê¸° ì‹œë„
        const res = await fetch(`/responses/${filename}`);
        if (res.ok) {
          const data = await res.json();
          console.log('âœ… ì‹¤í—˜ ë°ì´í„° ë¡œë“œ ì„±ê³µ:', data);
          console.log('ğŸ” ë°ì´í„° êµ¬ì¡°:', Object.keys(data));
          
          // user_input ì„¤ì • ìˆ˜ì •
          const userInput = data.user_input || (data.history && data.history[0] ? data.history[0].user_input : '');
          document.getElementById('inputText').value = userInput;
          
          // ë‹¤ì–‘í•œ ë°ì´í„° êµ¬ì¡° ì‹œë„
          let prompts = null;
          console.log('ğŸ” ë°ì´í„° ìƒì„¸ êµ¬ì¡°:', data);
          console.log('ğŸ” user_input í™•ì¸:', userInput);
          
          if (data.prompts && data.prompts.length > 0) {
            prompts = data.prompts;
            console.log('âœ… promptsì—ì„œ ë°ì´í„° ì°¾ìŒ:', prompts.length);
                      } else if (data.history && data.history.length > 0) {
              if (data.history[0].prompts) {
                prompts = data.history[0].prompts;
                console.log('âœ… history[0].promptsì—ì„œ ë°ì´í„° ì°¾ìŒ:', prompts.length);
              } else if (data.history[0].answers) {
                // JSONì˜ ëª¨ë“  ì§ˆë¬¸ê³¼ ë‹µë³€ì„ ì°¾ì•„ì„œ prompts êµ¬ì¡°ë¡œ ë³€í™˜
                console.log('ğŸ” JSONì—ì„œ ëª¨ë“  ì§ˆë¬¸ê³¼ ë‹µë³€ ì°¾ê¸° ì‹œì‘');
                
                // ëª¨ë“  history í•­ëª©ì—ì„œ ì§ˆë¬¸ê³¼ ë‹µë³€ ìˆ˜ì§‘
                const allQuestions = [];
                const questionAnswerMap = new Map(); // ì§ˆë¬¸ë³„ ë‹µë³€ ë§µ
                
                data.history.forEach((historyItem, historyIdx) => {
                  if (historyItem.question_text && historyItem.answers) {
                    allQuestions.push(historyItem.question_text);
                    console.log(`ğŸ” ì§ˆë¬¸ ${historyIdx + 1}: ${historyItem.question_text}`);
                    
                    // ê° ë‹µë³€ì„ ì§ˆë¬¸ë³„ë¡œ ì €ì¥
                    historyItem.answers.forEach((answer, answerIdx) => {
                      const key = `${historyItem.question_text}_${answerIdx}`;
                      questionAnswerMap.set(key, {
                        question: historyItem.question_text,
                        answer: answer.answer,
                        type: answer.type,
                        detail: answer.detail,
                        personality: answer.personality
                      });
                    });
                  }
                });
                
                console.log('ğŸ” ë°œê²¬ëœ ì´ ì§ˆë¬¸ ìˆ˜:', allQuestions.length);
                console.log('ğŸ” ì§ˆë¬¸ë³„ ë‹µë³€ ë§µ:', questionAnswerMap);
                
                // prompts êµ¬ì¡°ë¡œ ë³€í™˜ - ìˆ˜ì •ëœ ë¡œì§
                if (allQuestions.length > 0) {
                  prompts = data.history[0].answers.map((answer, answerIdx) => {
                    const allQa = [];
                    
                    // ëª¨ë“  ì§ˆë¬¸ì— ëŒ€í•´ ë‹µë³€ ì°¾ê¸°
                    allQuestions.forEach((questionText, questionIdx) => {
                      const key = `${questionText}_${answerIdx}`;
                      const qaData = questionAnswerMap.get(key);
                      
                      if (qaData) {
                        allQa.push({
                          question: questionText,
                          answer: qaData.answer
                        });
                      } else {
                        allQa.push({
                          question: questionText,
                          answer: null // í•´ë‹¹ ì§ˆë¬¸ì— ëŒ€í•œ ë‹µë³€ì´ ì—†ìŒ
                        });
                      }
                    });
                    
                    return {
                      type: answer.type,
                      detail: answer.detail,
                      personality: answer.personality,
                      qa: allQa
                    };
                  });
                  
                  console.log('âœ… historyì—ì„œ ëª¨ë“  ì§ˆë¬¸ê³¼ ë‹µë³€ì„ ì°¾ì•„ì„œ ë³€í™˜ë¨:', prompts.length);
                  console.log('ğŸ” ê° promptì˜ qa ê¸¸ì´:', prompts[0]?.qa?.length);
                } else {
                  // ì§ˆë¬¸ì´ ì—†ëŠ” ê²½ìš° answers ìì²´ë¥¼ promptsë¡œ ì‚¬ìš©
                  prompts = data.history[0].answers.map(answer => ({
                    type: answer.type,
                    detail: answer.detail,
                    personality: answer.personality,
                    qa: [{
                      question: 'ì§ˆë¬¸',
                      answer: answer.answer
                    }]
                  }));
                  console.log('âœ… answersë¥¼ ì§ì ‘ promptsë¡œ ë³€í™˜:', prompts.length);
                }
              } else if (data.history[0].instructions) {
                prompts = data.history[0].instructions;
                console.log('âœ… history[0].instructionsì—ì„œ ë°ì´í„° ì°¾ìŒ:', prompts.length);
              }
            } else if (data.instructions && data.instructions.length > 0) {
            prompts = data.instructions;
            console.log('âœ… instructionsì—ì„œ ë°ì´í„° ì°¾ìŒ:', prompts.length);
          } else if (Array.isArray(data) && data.length > 0) {
            // ë°ì´í„°ê°€ ë°°ì—´ì¸ ê²½ìš°
            console.log('âœ… ë°°ì—´ í˜•íƒœì˜ ë°ì´í„° ë°œê²¬:', data.length);
            if (data[0] && data[0].prompts) {
              prompts = data[0].prompts;
              console.log('âœ… data[0].promptsì—ì„œ ë°ì´í„° ì°¾ìŒ:', prompts.length);
            } else if (data[0] && data[0].instructions) {
              prompts = data[0].instructions;
              console.log('âœ… data[0].instructionsì—ì„œ ë°ì´í„° ì°¾ìŒ:', prompts.length);
            } else {
              // ë°°ì—´ ìì²´ê°€ promptsì¸ ê²½ìš°
              prompts = data;
              console.log('âœ… ë°°ì—´ ìì²´ê°€ prompts ë°ì´í„°:', prompts.length);
            }
          }
          
          if (prompts && prompts.length > 0) {
            currentInstructions = prompts;
            currentInput = userInput; // ìˆ˜ì •ëœ userInput ì‚¬ìš©
            // experimentNum ì„¤ì • ì¶”ê°€
            experimentNum = data.experiment_num || filename.replace('.json', '');
            currentPage = 0;
            console.log('âœ… currentInstructions ì„¤ì •ë¨:', currentInstructions.length);
            console.log('âœ… experimentNum ì„¤ì •ë¨:', experimentNum);
            console.log('âœ… currentInput ì„¤ì •ë¨:', currentInput);
            
            // ì²« ë²ˆì§¸ instruction í‘œì‹œ
            displayInstruction(currentPage);
            showPagination();
            
            // ìë™ìœ¼ë¡œ ì²« ë²ˆì§¸ ì§ˆë¬¸ ì„ íƒí•˜ì—¬ ì‘ë‹µ í‘œì‹œ
            const questionSelect = document.getElementById('question');
            console.log('ğŸ” ì§ˆë¬¸ ì„ íƒ ì˜µì…˜ ê°œìˆ˜:', questionSelect.options.length);
            
            if (questionSelect.options.length > 1) {
              questionSelect.selectedIndex = 1; // ì²« ë²ˆì§¸ ì§ˆë¬¸ ì„ íƒ (0ë²ˆì€ "ë¬¸í•­ì„ ì„ íƒí•˜ì„¸ìš”")
              console.log('âœ… ì²« ë²ˆì§¸ ì§ˆë¬¸ ì„ íƒë¨, displayResponsesByQuestion í˜¸ì¶œ');
              displayResponsesByQuestion(0); // ì²« ë²ˆì§¸ ì§ˆë¬¸(ì¸ë±ìŠ¤ 0)ì— ëŒ€í•œ ì‘ë‹µ í‘œì‹œ
            } else {
              console.log('âŒ ì§ˆë¬¸ ì˜µì…˜ì´ ë¶€ì¡±í•¨');
            }
          } else {
            console.log('âŒ prompts ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ');
            console.log('ğŸ” ì‚¬ìš© ê°€ëŠ¥í•œ í‚¤ë“¤:', Object.keys(data));
          }
        } else {
          console.error('âŒ API ì‘ë‹µ ì‹¤íŒ¨:', res.status);
          alert('ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨');
        }
      } catch (e) {
        console.error('âŒ ì‹¤í—˜ ë¶ˆëŸ¬ì˜¤ê¸° ì˜¤ë¥˜:', e);
        alert('ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨');
      }
    }



    // ì „ì—­ ë³€ìˆ˜ë¡œ ì‹¤í—˜ ìƒíƒœ ê´€ë¦¬
    let isExperimentRunning = false;
    let currentExperimentData = null;
    let stopRequested = false;

    window.addEventListener('DOMContentLoaded', () => {
      document.getElementById('start-btn').onclick = startExperiment;
      document.getElementById('stop-btn').onclick = stopExperiment;
      document.getElementById('end-btn').onclick = endExperiment;
      
      // ë²„íŠ¼ ì´ˆê¸° ìƒíƒœ ì„¤ì •
      document.getElementById('start-btn').style.display = 'inline-block';
      document.getElementById('stop-btn').style.display = 'none';
      document.getElementById('end-btn').style.display = 'inline-block';
      
      populateQuestions();
      
      // ì§ˆë¬¸ ì„ íƒ ì´ë²¤íŠ¸
      document.getElementById('question').addEventListener('change', function() {
        const idx = this.selectedIndex - 1;
        if (idx >= 0) {
          displayResponsesByQuestion(idx);
        }
      });
      fetchExperimentList();
    });
  </script>
</head>
<body>
  <div class="container">
    <!-- ì™¼ìª½ íŒ¨ë„ -->
    <div class="left-panel">
      <div class="header">
        <h1 class="title">BatchVis</h1>
        <hr class="underline" />
      </div>
      
      <!-- experiment-sectionì„ ìœ„ë¡œ ì´ë™ -->
      <div class="experiment-section">
        <h2>ì‹¤í—˜ ì‹œì‘</h2>
        <form id="experiment-form" onsubmit="return false;">
          <label for="experiment_num">ì‹¤í—˜ ë²ˆí˜¸:</label>
          <input type="text" id="experiment_num" name="experiment_num" placeholder="ì‹¤í—˜ ì‹œì‘ ë²„íŠ¼ í´ë¦­ì‹œ ë²ˆí˜¸ê°€ ìë™ìœ¼ë¡œ í• ë‹¹ë©ë‹ˆë‹¤" readonly />
          <button type="button" id="start-btn">ì‹¤í—˜ ì‹œì‘</button>
          <button type="button" id="stop-btn" style="display: none; background-color: #dc3545; color: white; border: none; padding: 8px 16px; border-radius: 4px;">ë©ˆì¶¤</button>
          <button type="button" id="end-btn">ì‹¤í—˜ ì™„ë£Œ</button>
        </form>
        
        <!-- Batch ìƒíƒœ í™•ì¸ ì„¹ì…˜ ì¶”ê°€ -->
        <div id="batch-status-section" style="display: none; margin-top: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 8px; border-left: 4px solid #17a2b8;">
          <h3 style="margin-top: 0; color: #17a2b8;">Batch API ìƒíƒœ í™•ì¸</h3>
          <label for="batch_id">Batch ID:</label>
          <input type="text" id="batch_id" placeholder="Batch IDë¥¼ ì…ë ¥í•˜ì„¸ìš”" style="width: 300px; margin-right: 10px;">
          <button onclick="checkBatchStatus()" style="background-color: #17a2b8; color: white; border: none; padding: 8px 16px; border-radius: 4px;">ìƒíƒœ í™•ì¸</button>
          <div id="batch-status-result" style="margin-top: 10px;"></div>
        </div>
        
        <div id="result"></div>
      </div>

      <!-- sidebarë¥¼ ì•„ë˜ë¡œ ì´ë™ -->
      <div class="sidebar">
        <div class="display-area" id="displayArea">
            <div>ì‹¤í—˜ì„ ì‹œì‘í•˜ë ¤ë©´ "ì‹¤í—˜ ì‹œì‘" ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.</div>
        </div>

        <div class="pagination" id="pagination" style="display: none;">
            <button onclick="prevPage()">&lt;</button>
            <span id="pageInfo">1 / 1</span>
            <button onclick="nextPage()">&gt;</button>
        </div>
        
        <div id="loading" class="loading" style="display: none;">ì²˜ë¦¬ ì¤‘...</div>
        <div id="result" class="result"></div>
        <div class="input-box" style="flex-direction: column; align-items: stretch; gap: 8px;">
          <div style="display: flex; align-items: center; gap: 8px;">
            <select id="loadExperimentSelect"   style="flex: 1; height: 40px; font-size: 16px;"></select>
            <button type="button" onclick="loadSelectedExperiment()">ë¶ˆëŸ¬<br>ì˜¤ê¸°</button>
          </div>
          <textarea id="inputText" placeholder="ì—¬ê¸°ì— í”„ë¡¬í”„íŠ¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”." rows="3"></textarea>
          <button onclick="submitText()">ì „ì†¡</button>
        </div>
      </div>
    </div>

    <!-- ì˜¤ë¥¸ìª½ íŒ¨ë„ -->
    <div class="main-panel">
      <div class="question-box">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
          <label for="question" style="font-size: 20px;">ì§ˆë¬¸ ì„ íƒ:</label>
          <a href="/visualization" class="analysis-btn" style="font-size: 16px; padding: 10px 20px; background-color: #8E12D5; color: white; text-decoration: none; border-radius: 6px; display: inline-block;">
            ì‹œê°í™”í•˜ëŸ¬ ê°€ê¸°
          </a>
        </div>
        <select id="question" style="width: 1000px; height: 35px; font-size: 14px;">
          <!-- ì§ˆë¬¸ ëª©ë¡ì€ JSì—ì„œ ë™ì ìœ¼ë¡œ ë¡œë“œ -->
        </select>
      </div>


      <!-- displayArea ì¶”ê°€ -->
      <div id="displayArea" style="margin-top: 20px; padding: 20px; background-color: #f8f9fa; border-radius: 8px;">
        <!-- ê¸°ë³¸ ì •ë³´ì™€ í”„ë¡¬í”„íŠ¸ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
      </div>

      <!-- response-boxë“¤ì€ ë™ì ìœ¼ë¡œ ìƒì„±ë¨ -->
    </div>
  </div>
</body>
</html>
